
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Vacant Classroom Finder</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <style>
       /* ───────────────  GLOBAL  ─────────────── */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Inter", "Segoe UI", sans-serif;
}

body {
    min-height: 100vh;
    padding: 30px;
    display: flex;
    justify-content: center;
    align-items: center;

    /* Modern dark theme background */
    background: radial-gradient(circle at top left, #3a1c71, #1f0a35 30%, #000 90%);
    background-attachment: fixed;
}

/* Container = Glass panel */
.container {
    width: 100%;
    max-width: 1000px;

    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(25px) saturate(1.8);
    border-radius: 22px;
    padding: 32px;
    border: 1px solid rgba(255, 255, 255, 0.12);

    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6),
                inset 0 0 40px rgba(255, 255, 255, 0.04);
}

/* ─────────────── HEADER ─────────────── */

header {
    text-align: center;
    color: #fff;
    margin-bottom: 25px;
}

header h1 {
    font-size: 2.6rem;
    font-weight: 700;
    background: linear-gradient(90deg, #e5d9ff, #a786ff);
    -webkit-background-clip: text;
    color: transparent;
}

header p {
    font-size: 1.15rem;
    opacity: 0.8;
}

/* ─────────────── CURRENT TIME ─────────────── */

.current-time {
    text-align: center;
    color: #e6e6e6;
    margin-bottom: 20px;
    font-size: 1.05rem;
}

/* ─────────────── SEARCH MODE BUTTONS ─────────────── */

.search-options {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
}

.option-btn {
    flex: 1;

    padding: 14px;
    border-radius: 14px;

    background: rgba(255, 255, 255, 0.07);
    color: #fff;
    border: 1px solid rgba(255, 255, 255, 0.12);

    cursor: pointer;
    transition: 0.25s ease;
}

.option-btn:hover {
    background: rgba(255, 255, 255, 0.15);
}

.option-btn.active {
    background: linear-gradient(135deg, #7b2ff7, #9f44ff);
    box-shadow: 0 4px 15px rgba(140, 59, 255, 0.4);
}

/* ─────────────── SEARCH PANEL (Glass Box) ─────────────── */

.search-panel {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.12);
    backdrop-filter: blur(20px);
    padding: 22px;
    border-radius: 16px;
    margin-bottom: 20px;
}

/* ─────────────── FORM ELEMENTS ─────────────── */

.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.form-group label {
    color: #dcdcdc;
    font-weight: 600;
    margin-bottom: 8px;
}

.form-control {
    width: 100%;
    padding: 12px 14px;

    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 12px;
    color: #fff;
}

.form-control:focus {
    outline: none;
    border-color: #b67bff;
    box-shadow: 0 0 0 3px rgba(182, 123, 255, 0.35);
}

.btn {
    width: 100%;
    padding: 12px 20px;
    margin-top: 10px;

    border: none;
    border-radius: 12px;

    background: linear-gradient(135deg, #7b2ff7, #9f44ff);
    color: #fff;
    font-weight: 600;
    font-size: 1.05rem;
    cursor: pointer;
    transition: 0.25s ease;
}

.btn:hover {
    box-shadow: 0 4px 20px rgba(140, 59, 255, 0.4);
}

/* ─────────────── RESULTS ─────────────── */

.results h3 {
    color: #e8e8e8;
    text-align: center;
    font-size: 1.35rem;
    margin-bottom: 14px;
}

.classroom-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 18px;
}

/* ─────────────── CLASSROOM CARD ─────────────── */

.classroom-card {
    background: rgba(255, 255, 255, 0.06);
    border: 1px solid rgba(255, 255, 255, 0.12);

    border-radius: 16px;
    padding: 18px;

    backdrop-filter: blur(20px);

    transition: 0.25s ease;
    color: #fff;

    box-shadow: 0 10px 25px rgba(0,0,0,0.5),
                inset 0 0 20px rgba(255,255,255,0.03);
}

.classroom-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 14px 30px rgba(0,0,0,0.6);
}

.classroom-card h4 {
    font-size: 1.25rem;
    text-align: center;
    margin-bottom: 12px;
    color: #fff;
}

/* Text lines */
.classroom-card p {
    margin-bottom: 8px;
    display: flex;
    gap: 10px;
    color: #eaeaea;
}

/* ─────────────── STATUS BADGES ─────────────── */

.status {
    display: inline-block;
    width: 100%;
    text-align: center;

    padding: 8px 12px;
    border-radius: 20px;

    font-size: 0.9rem;
    font-weight: 700;
    margin-top: 10px;
}

.status-vacant {
    background: rgba(0, 255, 90, 0.7);
    border: 1px solid rgba(46, 204, 113, 0.5);
}

.status-occupied {
    background: rgba(255, 50, 20, 0.7);
    border: 1px solid rgba(231, 76, 60, 0.5);
}

/* ─────────────── FOOTER ─────────────── */

.footer {
    text-align: center;
    margin-top: 25px;
    color: #cfcfcf;
    font-size: 0.9rem;
    opacity: 0.7;
}

/* ─────────────── RESPONSIVE ─────────────── */

@media (max-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr;
    }
}
/* FIX SELECT DROPDOWN VISIBILITY */

select,
.form-control {
    color: #fff !important;
}

/* Dropdown list (the opened menu) */
select option {
    background: #1d1b27 !important;  /* dark background */
    color: #ffffff !important;       /* visible text */
    padding: 10px;
}

/* Hovered option */
select option:hover {
    background: #7b2ff7 !important;
    color: #fff !important;
}


    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-door-open"></i> Vacant Classroom Finder</h1>
            <p>Find available classrooms and their schedules</p>
        </header>

        <div class="current-time">
            <i class="fas fa-clock"></i> Current Time: <span id="live-clock">Loading...</span>
        </div>

        <div class="search-options">
            <button class="option-btn active" id="live-btn"><i class="fas fa-play-circle"></i> Live Search</button>
            <button class="option-btn" id="custom-btn"><i class="fas fa-search"></i> Custom Search</button>
        </div>

        <div class="search-panel" id="live-search-panel">
            <div class="form-grid">
                <div class="form-group">
                    <label for="live-floor">Select Floor</label>
                    <select class="form-control" id="live-floor" onchange="findClassrooms('live')">
                        <option value="all">All Floors</option>
                        <option value="1">Ground Floor</option>
                        <option value="2">First Floor</option>
                        <option value="3">Second Floor</option>
                        <option value="4">Third Floor</option>
                        <option value="5">Fourth Floor</option>
                        <option value="6">Fifth Floor</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="live-type">Class Type</label>
                    <select class="form-control" id="live-type" onchange="findClassrooms('live')">
                        <option value="ALL">All</option>
                        <option value="CR">CR</option>
                        <option value="LT">LT</option>
                        <option value="LABS">LABS</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="search-panel" id="custom-search-panel" style="display: none;">
            <div class="form-grid">
                <div class="form-group">
                    <label for="custom-floor">Select Floor</label>
                    <select class="form-control" id="custom-floor">
                        <option value="all">All Floors</option>
                        <option value="1">Ground Floor</option>
                        <option value="2">First Floor</option>
                        <option value="3">Second Floor</option>
                        <option value="4">Third Floor</option>
                        <option value="5">Fourth Floor</option>
                        <option value="6">Fifth Floor</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="custom-day">Select Day</label>
                    <select class="form-control" id="custom-day">
                        <option value="MON">Monday</option>
                        <option value="TUE">Tuesday</option>
                        <option value="WED">Wednesday</option>
                        <option value="THU">Thursday</option>
                        <option value="FRI">Friday</option>
                    </select>
                </div>
            </div>

            <div class="form-grid" style="margin-top:14px;">
                <div class="form-group">
                    <label for="custom-time">Select Time</label>
                    <input type="time" class="form-control" id="custom-time" value="09:30">
                </div>
                <div class="form-group">
                    <label for="custom-type">Class Type</label>
                    <select class="form-control" id="custom-type">
                        <option value="ALL">All</option>
                        <option value="CR">CR</option>
                        <option value="LT">LT</option>
                        <option value="LABS">LABS</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="findClassrooms('custom')"><i class="fas fa-search"></i> Find Classrooms</button>
        </div>

        <div class="results">
            <h3 id="results-heading">Classroom Status</h3>
            <div class="classroom-list" id="results-container"></div>
        </div>

        <div class="footer">
            <p>Vacant Classroom Finder Project | DBMS Implementation</p>
        </div>
    </div>

    <script>
        // canonical classroom list (internal id, display label, floor)
        const allClassrooms = [
            // Ground Floor (1)
            { id: "CR101", display: "CR101", floor: 1 },
            { id: "CR102", display: "CR102", floor: 1 },
            { id: "CR103", display: "CR103", floor: 1 },
            { id: "CR104", display: "CR104", floor: 1 },
            { id: "CR105", display: "CR105", floor: 1 },
            { id: "LAB1_G", display: "LAB1", floor: 1 },
            { id: "LAB2_G", display: "LAB2", floor: 1 },      // internal LAB2_G (shows "LAB2")
            { id: "LAB10", display: "LAB10", floor: 1 },
            { id: "UBUNTULAB1", display: "UBUNTU LAB", floor: 1 },

            // First Floor (2)
            { id: "CR201", display: "CR201", floor: 2 },
            { id: "CR202", display: "CR202", floor: 2 },
            { id: "CR203", display: "CR203", floor: 2 },
            { id: "CR204", display: "CR204", floor: 2 },
            { id: "CR205", display: "CR205", floor: 2 },
            { id: "CR206", display: "CR206", floor: 2 },
            { id: "CR207", display: "CR207", floor: 2 },
            { id: "LT201", display: "LT201", floor: 2 },
            { id: "LT202", display: "LT202", floor: 2 },
            { id: "LAB2_F", display: "LAB2", floor: 2 },     // internal LAB2_F (shows "LAB2")
            { id: "LAB9", display: "LAB9", floor: 2 },
            { id: "TCL1", display: "TCL1", floor: 2 },
            { id: "TCL2", display: "TCL2", floor: 2 },

            // Second Floor (3)
            { id: "CR301", display: "CR301", floor: 3 },
            { id: "CR302", display: "CR302", floor: 3 },
            { id: "CR304", display: "CR304", floor: 3 },
            { id: "CR305", display: "CR305", floor: 3 },
            { id: "LT301", display: "LT301", floor: 3 },
            { id: "LT302", display: "LT302", floor: 3 },
            { id: "LAB3", display: "LAB3", floor: 3 },
            { id: "LAB8", display: "LAB8", floor: 3 },
            { id: "TCL3", display: "TCL3", floor: 3 },
            { id: "TCL4", display: "TCL4", floor: 3 },

            // Third Floor (4)
            { id: "LAB4", display: "LAB4", floor: 4 },
            { id: "CR401", display: "CR401", floor: 4 },
            { id: "CR402", display: "CR402", floor: 4 },
            { id: "LAB7", display: "LAB7", floor: 4 },
            { id: "CR403", display: "CR403", floor: 4 },
            { id: "CR406", display: "CR406", floor: 4 },
            { id: "LT401", display: "LT401", floor: 4 },
            { id: "LT402", display: "LT402", floor: 4 },
            { id: "CR405", display: "CR405", floor: 4 },
            { id: "CR404", display: "CR404", floor: 4 },

            // Fourth Floor (5)
            { id: "GCLAB1", display: "G.C. LAB 1", floor: 5 },
            { id: "GCLAB2", display: "G.C. LAB 2", floor: 5 },
            { id: "LT501", display: "LT501", floor: 5 },
            { id: "LT502", display: "LT502", floor: 5 },
            { id: "CR504", display: "CR504", floor: 5 },
            { id: "CR503", display: "CR503", floor: 5 },
            { id: "LAB5", display: "LAB5", floor: 5 },
            { id: "CR501", display: "CR501", floor: 5 },
            { id: "CR502", display: "CR502", floor: 5 },

            // Fifth Floor (6)
            { id: "CR601", display: "CR601", floor: 6 },
            { id: "CR602", display: "CR602", floor: 6 },
            { id: "CR603", display: "CR603", floor: 6 },
            { id: "CR604", display: "CR604", floor: 6 },
            { id: "CR605", display: "CR605", floor: 6 },
            { id: "LAB6", display: "LAB6", floor: 6 },
            { id: "CR606", display: "CR606", floor: 6 },
            { id: "LT601", display: "LT601", floor: 6 },
            { id: "LT602", display: "LT602", floor: 6 },
        ];

        let scheduledClasses = []; // loaded from JSON

        // Utility: normalize a string for comparisons
        function normalize(str) {
            return String(str || '').replace(/[^A-Za-z0-9]/g, '').toUpperCase();
        }

        // Determine if a classroom belongs to a selected type
        function classroomMatchesType(classroomObj, type) {
            if (!type || type === 'ALL') return true;
            const id = normalize(classroomObj.id);
            const disp = normalize(classroomObj.display);

            if (type === 'CR') {
                return id.startsWith('CR');
            }
            if (type === 'LT') {
                return id.startsWith('LT');
            }
            if (type === 'LABS') {
                // LABS should include: LABx, UBUNTU LAB, GCLAB, TCLx
                if (id.startsWith('LAB')) return true;       // LAB1, LAB2_G, LAB2_F, etc.
                if (disp.includes('UBUNTU')) return true;    // UBUNTULAB1 -> display "UBUNTU LAB"
                if (id.startsWith('GCLAB')) return true;     // GCLAB1, GCLAB2
                if (id.startsWith('TCL')) return true;       // TCL1..TCL4
                // fallback: display contains LAB
                if (disp.includes('LAB')) return true;
                return false;
            }
            return true;
        }

        // When JSON uses "LAB2" we want it to match both LAB2_G and LAB2_F (display = "LAB2"),
        // and when JSON uses the internal id (if any), it should match too.
        function roomMatches(classroomObj, jsonRoomStr) {
            if (!jsonRoomStr) return false;
            const jsonNorm = normalize(jsonRoomStr);
            const idNorm = normalize(classroomObj.id);
            const dispNorm = normalize(classroomObj.display);

            if (jsonNorm === idNorm) return true;     // exact internal id match
            if (jsonNorm === dispNorm) return true;   // display name match (e.g., "LAB2")
            return false;
        }

        // Convert "HH:MM" to minutes since 00:00
        function timeToMinutes(timeStr) {
            if (!timeStr || typeof timeStr !== "string") return NaN;
            const parts = timeStr.split(':');
            if (parts.length < 2) return NaN;
            const h = parseInt(parts[0], 10);
            const m = parseInt(parts[1], 10);
            if (Number.isNaN(h) || Number.isNaN(m)) return NaN;
            return h * 60 + m;
        }

        // Load JSON & init
        document.addEventListener("DOMContentLoaded", () => {
            fetch("extracted data/timetable.json")
                .then(resp => {
                    if (!resp.ok) throw new Error("timetable.json not found");
                    return resp.json();
                })
                .then(data => {
                    scheduledClasses = Array.isArray(data) ? data : [];
                    scheduledClasses = scheduledClasses.map(entry => ({
                        room: entry.room,
                        day: entry.day,
                        startTime: entry.startTime,
                        endTime: entry.endTime,
                        subjectCode: entry.subjectCode || "",
                        section: entry.section || ""
                    }));
                    findClassrooms('live');
                })
                .catch(err => {
                    console.warn("Timetable JSON not loaded or missing — continuing with empty schedule.", err);
                    scheduledClasses = [];
                    findClassrooms('live');
                });

            updateClock();
            setInterval(updateClock, 1000);
            setupPanelSwitching();
        });

        function updateClock() {
            const el = document.getElementById('live-clock');
            if (!el) return;
            const now = new Date();
            el.textContent = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
        }

        function setupPanelSwitching() {
            const liveBtn = document.getElementById('live-btn');
            const customBtn = document.getElementById('custom-btn');
            const livePanel = document.getElementById('live-search-panel');
            const customPanel = document.getElementById('custom-search-panel');

            liveBtn.addEventListener('click', () => {
                liveBtn.classList.add('active');
                customBtn.classList.remove('active');
                livePanel.style.display = 'block';
                customPanel.style.display = 'none';
                findClassrooms('live');
            });

            customBtn.addEventListener('click', () => {
                customBtn.classList.add('active');
                liveBtn.classList.remove('active');
                livePanel.style.display = 'none';
                customPanel.style.display = 'block';
            });
        }

        // Core: filter by floor + type, then compute status
        function findClassrooms(mode) {
            const now = new Date();
            const days = ['SUN','MON','TUE','WED','THU','FRI','SAT'];

            let day, time, floor, type;
            if (mode === 'live') {
                day = days[now.getDay()];
                time = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
                floor = document.getElementById('live-floor').value;
                type = document.getElementById('live-type').value;
                document.getElementById('results-heading').innerText = `Classroom Status Right Now (${day} ${time})`;
            } else {
                day = document.getElementById('custom-day').value;
                time = document.getElementById('custom-time').value;
                floor = document.getElementById('custom-floor').value;
                type = document.getElementById('custom-type').value;
                document.getElementById('results-heading').innerText = `Classroom Status on ${day} at ${time}`;
            }

            // filter classroom objects by floor & type
            const filtered = allClassrooms.filter(c => {
                const floorOk = (floor === 'all') ? true : Number(c.floor) === Number(floor);
                const typeOk = classroomMatchesType(c, type);
                return floorOk && typeOk;
            });

            displayResults(filtered, day, time);
        }

        // Determine if a classroom is occupied at given day/time
        function getRoomStatus(classroomObj, day, time) {
            const searchMinutes = timeToMinutes(time);
            if (isNaN(searchMinutes)) return { status: 'Vacant', details: [] };

            const matches = scheduledClasses.filter(entry => {
                if (!entry || !entry.room) return false;
                if (entry.day !== day) return false;

                if (!roomMatches(classroomObj, entry.room)) return false;

                const start = timeToMinutes(entry.startTime);
                const end = timeToMinutes(entry.endTime);
                if (isNaN(start) || isNaN(end)) return false;

                // include start inclusive, end exclusive
                return searchMinutes >= start && searchMinutes < end;
            });

            return matches.length > 0 ? { status: 'Occupied', details: matches } : { status: 'Vacant', details: [] };
        }

        // Render results
        function displayResults(classroomObjs, day, time) {
            const container = document.getElementById('results-container');
            container.innerHTML = '';

            if (!classroomObjs || classroomObjs.length === 0) {
                container.innerHTML = '<p style="color: #fff; text-align: center; grid-column: 1 / -1;">No classrooms match the selected filters.</p>';
                return;
            }

            classroomObjs.forEach(obj => {
                const info = getRoomStatus(obj, day, time);
                const card = document.createElement('div');
                card.className = 'classroom-card';

                const title = obj.display || obj.id;

                let detailsHTML = '';
                if (info.status === 'Occupied') {
                    const subjects = [...new Set(info.details.map(d => d.subjectCode).filter(Boolean))].join(', ');
                    const sections = [...new Set(info.details.map(d => d.section).filter(Boolean))].join(', ');
                    const first = info.details[0];
                    detailsHTML = `
                        <p><i class="fas fa-book"></i> <strong>Subject(s):</strong> ${subjects || "-"}</p>
                        <p><i class="fas fa-users"></i> <strong>Section(s):</strong> ${sections || "-"}</p>
                        <p><i class="fas fa-clock"></i> <strong>Scheduled:</strong> ${first.startTime} - ${first.endTime}</p>
                    `;
                } else {
                    detailsHTML = `
                        <p><i class="fas fa-check-circle"></i> This classroom is currently available.</p>
                        <p style="opacity:0;">-</p>
                        <p style="opacity:0;">-</p>
                    `;
                }

                card.innerHTML = `
                    <h4>${title}</h4>
                    ${detailsHTML}
                    <div class="status ${info.status === 'Vacant' ? 'status-vacant' : 'status-occupied'}">${info.status.toUpperCase()}</div>
                `;
                container.appendChild(card);
            });
        }

        // For debugging: expose classroom list
        window.__CLASSROOMS = allClassrooms.map(c => ({ id: c.id, display: c.display, floor: c.floor }));
    </script>
</body>
</html>

